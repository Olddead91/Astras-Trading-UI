<nz-header>
  <div class="logo">
    <a [routerLink]="['/']"></a>
  </div>
  <div class="menu-item">
    <button nz-button [nzType]="'text'"
            (click)="newOrder()"
            joyrideStep="step3"
            [title]="joyrideContent.step3.title"
            [text]="joyrideContent.step3.text">
      <i nz-icon nzType="plus-circle" nzTheme="twotone" [nzTwotoneColor]="(themeColors$ | async)!.buyColor" class='managing-icon'></i>
    </button>
  </div>
  <div class="menu-item">
    <button nz-button nz-dropdown
            [nzDropdownMenu]="widgetsMenu"
            nzSize='small'
            joyrideStep="step2"
            [title]="joyrideContent.step2.title"
            [text]="joyrideContent.step2.text">
      Виджет
      <i nz-icon nzType="plus"></i>
    </button>
  </div>
  <div class="menu-item" *ngIf="portfolios$ | async as portfolios">
    <nz-select nzSize='small'
               nzShowSearch
               [ngModel]="selectedPortfolio$ | async"
               (ngModelChange)="changePortfolio($event)"
               joyrideStep="step1"
               [title]="joyrideContent.step1.title"
               [text]="joyrideContent.step1.text"
               id="portfolios-list">
      <nz-option-group *ngFor='let kvp of portfolios | keyvalue' [nzLabel]="kvp.key">
        <nz-option *ngFor='let model of kvp.value' [nzValue]="model" nzLabel="{{model.market}} {{model.portfolio}}">
        </nz-option>
      </nz-option-group>
    </nz-select>
  </div>
  <div class="menu-item contrast-icon">
    <button nz-button [nzType]="'text'"
            (click)="clear()"
            joyrideStep="step4"
            [title]="joyrideContent.step4.title"
            [text]="joyrideContent.step4.text"
            nz-tooltip="Очистить дашборд">
      <i nz-icon nzType="delete" nzTheme="outline"class='managing-icon'></i>
    </button>
  </div>
  <div class="right contrast-icon">
      <div class="notifications">
        <ats-notification-button></ats-notification-button>
      </div>
    <div>
      <button nz-button nz-dropdown [nzDropdownMenu]="rightMenu" nzPlacement="bottomRight" [nzType]="'text'">
        <i nz-icon nzType="user"></i>
      </button>
    </div>
  </div>
</nz-header>


<nz-dropdown-menu #widgetsMenu="nzDropdownMenu">
  <ats-widget-menu (selected)="addItem($event)"></ats-widget-menu>
</nz-dropdown-menu>

<nz-dropdown-menu #rightMenu="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item (click)="openTerminalSettings()" class='menu-item' >
      <span><i nz-icon nzType="user" nzTheme="outline"></i> <label>&nbsp;Профиль</label></span>
    </li>
    <li nz-menu-item class='menu-item external-link' (click)="openThirdPartyLink('https://lk.alor.ru/reports/broker')">
      <span>
        <i nz-icon nzType="audit" nzTheme="outline"></i>
        <ng-container [ngTemplateOutlet]="externalLink" [ngTemplateOutletContext]="{name:'Отчеты'}"></ng-container>
      </span>
    </li>
    <li nz-menu-item class='menu-item external-link' (click)="openThirdPartyLink('https://warp.alor.dev/ru/releases/astras')">
      <span>
        <i nz-icon nzType="history" nzTheme="outline"></i>
        <ng-container [ngTemplateOutlet]="externalLink" [ngTemplateOutletContext]="{name:'Релизы'}"></ng-container>
      </span>
    </li>
    <li nz-menu-item class='menu-item external-link' (click)="openThirdPartyLink('https://t.me/+oM0i9QbtD4cwMzNi')">
      <span>
        <i nz-icon nzType="customer-service" nzTheme="outline"></i>
        <ng-container [ngTemplateOutlet]="externalLink" [ngTemplateOutletContext]="{name:'Техподдержка'}"></ng-container>
      </span>
    </li>
    <li nz-menu-item (click)="logout()" class='menu-item' >
      <span><i nz-icon nzType="logout" nzTheme="outline"></i> <label>&nbsp;Выйти</label></span>
    </li>
  </ul>

  <ng-template #externalLink let-name='name'>
    <span class="link-label"><label>&nbsp;{{name}} </label><span nz-icon nzType="ats-external-link" nzTheme="outline"></span></span>
  </ng-template>
</nz-dropdown-menu>
