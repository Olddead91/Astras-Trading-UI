<p>Настройки</p>
<div>
  <form nz-form [nzLayout]="'horizontal'" [formGroup]="form" (ngSubmit)="submitForm()">
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите портфель">
        <nz-form-label nzRequired nzFor="portfolio">Портфель</nz-form-label>
        <nz-select
          formControlName="portfolio"
          nzAllowClear
          nzPlaceHolder="Портфель"
          nzShowSearch
          (ngModelChange)="portfolioChanged($event)"
          *ngIf="availablePortfolios$ | async as availablePortfolios">
          <ng-container *ngFor="let agreement of availablePortfolios.keys()">
            <nz-option-group [nzLabel]="agreement">
              <ng-container *ngIf="availablePortfolios.get(agreement) as portfolios">
                <ng-container *ngFor="let portfolio of portfolios">
                  <nz-option [nzValue]="toPortfolioKey(portfolio)" [nzLabel]="portfolio.market + ' ' +  portfolio.portfolio"></nz-option>
                </ng-container>
              </ng-container>
            </nz-option-group>
          </ng-container>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите биржу">
        <nz-form-label nzFor="exchange" nzRequired>Биржа</nz-form-label>
        <nz-form-control>
          <input class='ant-input' formControlName='exchange' nz-input>
        </nz-form-control>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите колонки">
        <nz-form-label nzRequired nzFor="ordersColumns">Колонки заявок</nz-form-label>
        <nz-select [nzMaxTagCount]="10" [nzMaxTagPlaceholder]="tagPlaceHolder" nzMode="multiple"
          nzPlaceHolder="Выберите..." formControlName="ordersColumns">
          <nz-option *ngFor="let item of allOrdersColumns" [nzLabel]="item.name" [nzValue]="item.columnId"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите колонки">
        <nz-form-label nzRequired nzFor="stopOrdersColumns">Колонки стоп-заявок</nz-form-label>
        <nz-select [nzMaxTagCount]="10" [nzMaxTagPlaceholder]="tagPlaceHolder" nzMode="multiple"
          nzPlaceHolder="Выберите..." formControlName="stopOrdersColumns">
          <nz-option *ngFor="let item of allStopOrdersColumns" [nzLabel]="item.name" [nzValue]="item.columnId"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите колонки">
        <nz-form-label nzRequired nzFor="ordersColumns">Колонки сделок</nz-form-label>
        <nz-select [nzMaxTagCount]="10" [nzMaxTagPlaceholder]="tagPlaceHolder" nzMode="multiple"
          nzPlaceHolder="Выберите..." formControlName="tradesColumns">
          <nz-option *ngFor="let item of allTradesColumns" [nzLabel]="item.name" [nzValue]="item.columnId"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control nzErrorTip="Выберите колонки">
        <nz-form-label nzRequired nzFor="ordersColumns">Колонки позиций</nz-form-label>
        <nz-select [nzMaxTagCount]="10" [nzMaxTagPlaceholder]="tagPlaceHolder" nzMode="multiple"
          nzPlaceHolder="Выберите..." formControlName="positionsColumns">
          <nz-option *ngFor="let item of allPositionsColumns" [nzLabel]="item.name" [nzValue]="item.columnId">
          </nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzFor="isSoldPositionsHidden">Скрыть проданные</nz-form-label>
      <nz-switch formControlName='isSoldPositionsHidden'></nz-switch>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzFor="cancelOrdersWithoutConfirmation">Отменять заявки без подтверждения</nz-form-label>
      <nz-switch formControlName='cancelOrdersWithoutConfirmation'></nz-switch>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control>
        <button type="submit" nz-button nzType="primary" [disabled]="!form.valid">Сохранить</button>
      </nz-form-control>
    </nz-form-item>
  </form>
</div>

<ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
